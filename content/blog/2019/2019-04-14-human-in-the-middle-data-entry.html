---
title: Human-in-the-Middle Data Entry
author: Garrick Aden-Buie
date: '2019-04-14'
slug: human-in-the-middle-data-entry
description: "post description"
twitterImage: "/path/to/image.png"
categories:
  - Blog
tags:
  - r
  - Scripts
editor_options:
  chunk_output_type: console
---



<pre class="r"><code>speak &lt;- function(x) {
  if (inherits(x, &quot;data.frame&quot;)) {
    for (name in names(x)) {
      x[[name]] &lt;- paste0(name, &quot;: &quot;, x[[name]])
    }
    x &lt;- apply(x, 1, paste, collapse = &quot;. &quot;)
  }
  for (thing in x) {
    system2(&quot;say&quot;, paste0(&quot;&#39;&quot;, thing, &quot;&#39;&quot;))
    if (length(x) &gt; 1) Sys.sleep(0.5)
  }
}

walk_rows &lt;- function(
  df,
  copy = NULL,
  speak_quick = NULL,
  speak_full = NULL,
  start_at = 1L,
  pause_short = 1L,
  pause_long = 2L,
  break_at = 20L
) {
  touch_columns &lt;- c(copy, speak_quick, speak_full)
  if (identical(names(df), setdiff(names(df), touch_columns))) {
    warning(&quot;No columns in `copy`, `speak_quick`, `speak_full` match the columns in `df`&quot;)
    return(df)
  }

  if (nrow(df) == 0 || start_at &gt; nrow(df)) {
    stop(&quot;All done!&quot;, call. = FALSE)
  }

  if (start_at %% break_at == 0) {
    speak(&quot;Take a break or save your progress&quot;)
    is_ready &lt;- FALSE
    while(!is_ready) {
      if (!is_ready) {
        cat(&quot;\n...waiting...&quot;)
        Sys.sleep(pause_long)
      }
      is_ready &lt;- rstudioapi::showQuestion(&quot;Ready?&quot;, &quot;Ready to continue?&quot;)
    }
  }

  cat(start_at, &quot;...&quot;, sep = &quot;&quot;)
  for (col in names(df)) {
    delay &lt;- ifelse(
      which(col == names(df)) == length(ncol(df)),
      pause_long, pause_short
    )

    if (col %in% copy) {
      the_value &lt;- df[[col]][start_at]
      if (!is.numeric(the_value) || abs(the_value) &gt;= 0.01) {
        clipr::write_clip(the_value)
        speak(col)
        Sys.sleep(delay)
      }
    } else if (col %in% speak_full) {
      speak(df[start_at, col])
      Sys.sleep(delay)
    } else if (col %in% speak_quick) {
      the_value &lt;- df[[col]][start_at]
      speak(the_value)
      Sys.sleep(delay)
    }
  }

  walk_rows(df, copy, speak_quick, speak_full, start_at + 1L, pause_short, pause_long)
}</code></pre>
