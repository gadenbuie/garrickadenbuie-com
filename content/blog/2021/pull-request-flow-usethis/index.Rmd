---
title: Pull Request Flow with usethis
author: Garrick Aden-Buie
date: '2021-10-01'
slug: pull-request-flow-usethis
categories:
  - Blog
tags:
  - R
  - usethis
  - Pull Requests
  - Workflow
description: Get in the usethis pull request flow with this flow chart.
twitterImage: /blog/pull-request-flow-usethis/usethis-pr-flow-small.jpg
rmd_source: 'https://github.com/gadenbuie/garrickadenbuie-com/tree/main/content/blog/2021/pull-request-flow-usethis/index.Rmd'
keywords: rstats
editor_options:
  chunk_output_type: console
---

[usethis]: https://usethis.r-lib.org
[gert]: https://docs.ropensci.org/gert/

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, warning = FALSE, message = FALSE,
  fig.width = 9, fig.height = 10
)

options(htmltools.dir.version = TRUE)

# If using lightbox for plots, set `fig.show = FALSE`
# Usage: lightbox_img(knitr::fig_chunk("chunk-name", "png"))
lightbox_img <- function(url, alt = "", caption = "", preview = TRUE) {
  if (preview) {
    glue::glue(
      '<div class="figure">
      <a href="{url}" data-featherlight="image">
      <img src="{url}" alt="{alt}">
      </a>
      <p class="caption">{caption}</p>
      </div>
      '
    )
  } else {
    if (alt == "") alt <- "static image of the plot"
    glue::glue('<a href="{url}" data-featherlight="image">{alt}</a>')
  }
}

way_point <- function(add_class = TRUE) {
  glue::glue(
    '<i class="{cls}fas fa-map-signs" aria-hidden="true" title="Decision Time"></i>', 
    '<span class="sr-only">Decision time:</span>',
    cls = if (add_class) "way-point " else ""
  )
}

back_button <- function() {
  glue::glue(
    '<i class="fas fa-arrow-alt-circle-left" aria-hidden="true" title="Back"></i>', 
    '<span class="sr-only">back</span>'
  )
}
```

```{r pr-flow-lightbox, echo=FALSE, results = "asis"}
lightbox_img(
  "usethis-pr-flow-medium.jpg",
  alt = "A flow chart for the pull request functions in the usethis R package.",
  caption = "A `usethis` pull request helper function flow. [Download the image](#download)."
)
```

## Choose your own pull request adventure

Welcome to this choose-your-own-adventure blog post.
You don't need to read this one from top to bottom.
Instead, jumping around is encouraged!

Look for the `r way_point(FALSE)` icon.
It tells you that it's time for you make a choice.
Remember, there's no wrong choice:
if you take a wrong turn
you can always use your browser's `r back_button()` button
to retrace your steps.

`r way_point()` Ready to [get started](#start)?

### Start here {#start}

You open your project in RStudio (or the editor of your choice).
You make a note to yourself to come up with a better name for your package —
for now you're calling it [acme]{.pkg} 
because it's mostly a collection of random functions you've written.

Anyway, you're thankful that you closed all of your open files the last time you were working,
but now the empty console beckons.
You're ready to do some work.

Where do you begin? With [[usethis]]{.pkg} of course.

```{r eval=TRUE}
library(usethis)
```

::: {#start-here}
`r way_point()` Now you face a harder decision: what do you actually do next?

1. [Start new work](#start-new-work)

1. [Pick up something you were working on](#resume-my-work)

1. [Review someone else's work](#review-others-work)
:::

### Start new work {#start-new-work}

Time to start something new.
You scan your project board, issues list, JIRA tickets, slack messages, emails, and post-it notes
and finally settle on something to work on.
Your task: add an example to the documentation for a function you've been working on.

::: {#pr-init}
You want to start your work in a new branch,
so you call `pr_init()`,
giving it the name of your new branch.

```{r pr-init, eval=FALSE}
pr_init("add-example")
```
```
✓ Setting active project to '/Users/garrick/work/acme'
ℹ Pulling changes from 'upstream/main'
✓ Creating and switching to local branch 'add-example'
● Use `pr_push()` to create PR.
```
:::

The console output reminds you that [usethis]{.pkg} updated your local repo
and created and switched to a new branch for you.

`r way_point()` You're ready to [do some work](#do-work).

### Pick up something you were working on {#pr-resume}

TK: resume your local work with `pr_resume()`

### Review someone else's work {#pr-fetch}

TK: review work from others with `pr_fetch()`

## Update your local copy {#do-update}

TK: [get to the right branch](#do-choose-branch) and then choose `pr_pull()` or `pr_merge_main()`

### Update your local copy with someone else's changes {#pr-pull}

TK: `pr_pull()`

### Bring your work up to date with the main branch {#pr-merge-main}

TK: `pr_merge_main()`


### Get to the right place {#do-choose-branch}

- The one I'm in right now<br/>
  &rArr; _you're all set, go [get some work done](#do-work)_!

- A local branch, but not the one I'm in now<br/>
  &rArr; _go [resume working in that branch](#pr-resume)
  and then come right back here._

- A pull request branch I was looking at on GitHub<br/>
  &rArr; _go [fetch the pull request](#pr-fetch)
  and then come right back here_.
  

## Do some work {#do-work}

You take a sip of your coffee (or the beverage of your choice),
turn up your favorite [music to write code to](https://open.spotify.com/playlist/1fk6kpO8nb1KAUc1XAkAJ6) playlist on Spotify,
and line up 25 minutes in your [Pomodoro app](https://pomofocus.io/).

You're ready to get something done!
Go write some code.

`r way_point()` When you feel good about your work,
come back here and we'll [take a snapshot of your updates](#git-commit).

### Take a snapshot of your work {#git-commit}

Feeling okay about your code? 
Take a snapshot of it!

There are two parts to this step.
And really, 
it's less like taking a picture and more like sending yourself an email
with a copy of your files.

First, you'll pick the files that you want to add to the snapshot (or commit).
You can do this in the R console using `git_add()` from the [[gert]]{.pkg} package.
Give the function a vector with the paths to the files you changed.

```{r eval=FALSE}
gert::git_add(c("R/atom_arranger.R", "man/atom_arranger.Rd"))
```

In git-speak, 
`git_add()` adds the changes in the listed files to a staging area.
Running this command is like dragging a file into the email you're writing.
We haven't officially sent that email yet,
but we have a copy ready to go.
By the way,
you can still make more changes to the file
knowing that there's a temporary copy in that email draft
in case anything goes wrong.

Then, once all the files you want to commit have been added,
you _commit_ the changes.
In our email metaphor,
committing is a lot like pressing send on the email.

And just like an email, 
the commit includes a message
where you can describe the updates you made to the files in the email (commit).

For this step you can use
`git_commit()` 
(also from the [[gert]]{.pkg} package)
which takes the commit message as a parameter.
Think of this message like the subject of an email to your future self.

```{r eval=FALSE}
gert::git_commit("Add an example to ?atom_arranger()")
```

_P.S. You can do this adding-and-committing dance in the [Git pane in RStudio](https://happygitwithr.com/rstudio-git-github.html), too._

`r way_point()` Are you ready to share your work?

- If **yes**, then you're ready to [push your changes out into the world](#share-your-work).

- If **not**, no worries. Just [keep on working](#do-work).


  
### Fix something {#fix-something}

Oh no, you need to fix something!
I hope it's just a typo and not a big scary error.
But first...

`r way_point()` 
Quick question: 
this thing that needs to be fixed — what branch is it in?

- The one that I'm in now, I'm ready to [get some work done and fix this thing](#do-work)
- Not this one, [I need to change branches](#do-choose-branch)

## Share your work {#share-your-work}

Fantastic!
Your work is awesome and everyone is going to be happy to try it out,
but first you have to get it off of your computer and out into the world.

`r way_point()` Is this [new work](#pr-push-new) you're sharing,
or are you [updating an existing pull request](#pr-push) with either your own or someone else's work?

### Create a new pull request {#pr-push-new}

To create a new pull request, you call `pr_push()`.

```{r pr-push-new, eval=FALSE}
pr_push()
```
```
✔ Pushing local 'add-example' branch to 'origin:add-example'
✔ Setting upstream tracking branch for 'add-example' to 'origin/add-example'
✔ Create PR at link given below
✔ Opening URL 'https://github.com/gadenbuie/acme/compare/add-example'
```

`pr_push()` sends the local changes in your new branch to GitHub,
and opens a browser window where you can review your changes once more.
If everything looks good, 
go ahead click the _Create Pull Request_ button.

`r way_point()` Good job! How are you feeling now?

- I'm on a roll, let's [start the next thing](#pr-pause).

- Oh shoot, [I saw something I need to fix](#fix-something).

- Great, that pull request was just merged and [I'm done with this work](#pr-finish).

- Someone else made changes in the PR [and now I need to update my local copy](#pr-pull).

- Actually, the pull request was closed and [I can forget about this work](#pr-forget).

### Update an existing pull request {#pr-push}

You just made [and committed](#git-commit) some changes to an existing pull request,
and now you'd like to update the PR on GitHub.
`pr_push()` also does this for you!
Helpfully, before it pushes it checks to make sure your local branch is up-to-date.

```{r pr-push, eval=FALSE}
pr_push()
```
```
✔ Checking that local branch 'add-example' has the changes in 'origin/add-example'
✔ Pushing local 'add-example' branch to 'origin:add-example'
✔ View PR at 'https://github.com/gadenbuie/acme/pull/11' or call `pr_view()`
```

If the PR is a change that someone else is suggesting for your package,
`pr_push()` will send the changes to the correct repository.
Here's the output you'll see after you make a few changes
to the pull request submitted by `@wileycoyote` in the `toone-model` branch.

```{r pr-push-external, eval=FALSE}
pr_push()
```
```
✔ Checking that local branch 'wileycoyote-toone-model' has the changes in 'wileycoyote/toone-model'
✔ Pushing local 'wileycoyote-toone-model' branch to 'wilecoyote:toone-model'
✔ View PR at 'https://github.com/gadenbuie/acme/pull/14' or call `pr_view()`
```

`r way_point()` Phenomenal! What do you want to do next?

- Beep, beep! I'm moving on to [start the next thing](#pr-pause).

- Hang on, [I saw something I need to fix](#fix-something).

- That's all I wanted to do, I can [forget about this PR now](#pr-forget).

- Someone else made changes in the PR [and now I need to update my local copy](#pr-pull).

- I just merged this pull request and [I'm all done with this work](#pr-finish).

## Wrap Up

### Pause your work {#pr-pause}

If you landed here, 
you're not completely done with the thing you were working on,
but you do want to put it aside for now.
That's alright, that work will be waiting patiently for you in a local branch.

Call `pr_pause()` to switch from the current branch back to the default branch,
and to make sure you've got the latest changes in the default branch.

```{r eval=FALSE}
pr_pause()
```
```
✓ Switching back to default branch ('main')
✓ Pulling changes from 'origin/main'
```

`r way_point()` [Go back to Start](#start-here) to decide what's next in your adventure.

### Finish your work {#pr-finish}

Congrats! Your pull request was merged or your review of someone else's work is complete!
That's awesome.
Now it's time to wrap things up by calling `pr_finish()`.

```{r pr_finish, eval=FALSE}
pr_finish()
```

`r way_point()` [Go back to Start](#start-here) to decide what's next in your adventure.

### Forget about it {#pr-forget}

TK: Forget about this PR!


## Download the image {#download}

- [Small PNG Image (94 KB)](usethis-pr-flow.png)
- [Medium PNG Image (600 KB)](usethis-pr-flow-medium.png)
- [Large PNG Image (820 KB)](usethis-pr-flow-large.png)
- [SVG (36 KB)](usethis-pr-flow.svg)
- [Source File `.drawio` (3.4 KB)](usethis-pr-flow.drawio)

::: cc-box

```{=html}
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0;margin-right:1em;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" align="left" />
</a>
<em xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/StillImage" property="dct:title" rel="dct:type">
  Pull Request Flow with usethis
</em>
by 
<a xmlns:cc="http://creativecommons.org/ns#" href="https://www.garrickadenbuie.com/blog/pull-request-flow-usethis" property="cc:attributionName" rel="cc:attributionURL">
Garrick Aden-Buie
</a> is licensed under a 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
```

:::


```{css echo=FALSE}
.cc-box {
  padding: 1em 1em;
  border: 2px solid #514961;
  border-radius: 3px;
}
@media (prefers-color-scheme: dark) {
  .cc-box {
    color: #dbd7e3;
  }
}
.cc-box :first-child {
  margin-top: 0;
}
.cc-box :last-child {
  margin-bottom: 0;
}
.fas.fa-map-signs,
.fas.fa-arrow-alt-circle-left {
	color: var(--accent-dark);
}

@media screen and (min-width: 48em) {
  .way-point {
    position: absolute;
    left: -1.5em;
    line-height: 1.25;
    font-size: 1.25em;
    z-index: 1000;
  }
  
  .page, .post {
    position: relative;
  }
}

.sr-only {
  border: 0 !important;
  clip: rect(1px, 1px, 1px, 1px) !important;
  -webkit-clip-path: inset(50%) !important;
  clip-path: inset(50%) !important;
  height: 1px !important;
  overflow: hidden !important;
  padding: 0 !important;
  position: absolute !important;
  width: 1px !important;
  white-space: nowrap !important;
}
```
