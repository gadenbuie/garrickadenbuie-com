---
title: Pull Request Flow with usethis
author: Garrick Aden-Buie
date: '2021-10-01'
slug: pull-request-flow-usethis
categories:
  - Blog
tags:
  - R
  - usethis
  - Pull Requests
  - Workflow
description: Get in the usethis pull request flow with this flow chart.
twitterImage: /blog/pull-request-flow-usethis/usethis-pr-flow-small.jpg
rmd_source: 'https://github.com/gadenbuie/garrickadenbuie-com/tree/main/content/blog/2021/pull-request-flow-usethis/index.Rmd'
keywords: rstats
editor_options:
  chunk_output_type: console
---

<script src="{{< blogdown/postref >}}index_files/header-attrs-2.10/header-attrs.js"></script>


<div class="figure">
<a href="usethis-pr-flow-medium.jpg" data-featherlight="image">
<img src="usethis-pr-flow-medium.jpg" alt="A flow chart for the pull request functions in the usethis R package.">
</a>
<p class="caption">
A <code>usethis</code> pull request helper function flow. <a href="#download">Download the image</a>.
</p>
</div>
<div id="intro" class="section level2">
<h2>Choose your own pull request adventure</h2>
<p>Welcome to this choose-your-own-adventure blog post.
<span id="instructions-non-interactive">You don‚Äôt need to read this one from top to bottom.
Instead, jumping around is encouraged!</span>
<span id="instructions-interactive">It‚Äôs a little bit unusual, but don‚Äôt worry, I‚Äôll walk you through it.</span></p>
<p>Look for the <i class="fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> icon.
It tells you that it‚Äôs time for you make a choice.
Remember, there‚Äôs no wrong choice:
if you take a wrong turn
you can always use your browser‚Äôs <i class="fas fa-arrow-alt-circle-left" aria-hidden="true" title="Back"></i><span class="sr-only">back</span> button
to retrace your steps.</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Ready to get started?</p>
<ul id="intro-options">
<li>
<p>
Yes, <a href="#start">I‚Äôm ready to go</a>!
</p>
</li>
</ul>
</div>
<div id="story" aria-live="polite" aria-relevant="additions">

</div>
<div id="start" class="section level3 step">
<h3>Start here</h3>
<p>You open your project in RStudio (or the editor of your choice).
You make a note to yourself to come up with a better name for your package ‚Äî
for now you‚Äôre calling it <span class="pkg">acme</span>
because it‚Äôs mostly a collection of random functions you‚Äôve written.</p>
<p>Anyway, you‚Äôre thankful that you closed all of your open files the last time you were working,
but now the empty console beckons.
You‚Äôre ready to do some work.</p>
<p>Where do you begin? With <span class="pkg"><a href="https://usethis.r-lib.org">usethis</a></span> of course.</p>
<pre class="r"><code>library(usethis)</code></pre>
<div id="start-here" class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Now you face a harder decision: what do you actually do next?</p>
<ol style="list-style-type: decimal">
<li><p><a href="#pr-init">Start new work</a></p></li>
<li><p><a href="#pr-resume">Pick up something you were working on</a></p></li>
<li><p><a href="#pr-fetch">Review someone else‚Äôs work</a></p></li>
</ol>
</div>
</div>
<div id="pr-init" class="section level3 step">
<h3>Start new work</h3>
<p>Time to start something new.
You scan your project board, issues list, JIRA tickets, slack messages, emails, and post-it notes
and finally settle on something to work on.
Your task: add an example to the documentation for a function you‚Äôve been working on.</p>
<p>You want to start your work in a new branch,
so you call <code>pr_init()</code>,
giving it the name of your new branch.</p>
<pre class="r"><code>pr_init(&quot;add-example&quot;)</code></pre>
<pre><code>‚úì Setting active project to &#39;/Users/garrick/work/acme&#39;
‚Ñπ Pulling changes from &#39;upstream/main&#39;
‚úì Creating and switching to local branch &#39;add-example&#39;
‚óè Use `pr_push()` to create PR.</code></pre>
<p>The console output reminds you that <span class="pkg">usethis</span> updated your local repo
and created and switched to a new branch for you.</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> You‚Äôre ready to <a href="#do-work">do some work</a>.</p>
</div>
</div>
<div id="pr-resume" class="section level3 step">
<h3>Pick up something you were working on</h3>
<p>You‚Äôre ready to get back to that thing you were working on.
Which was what again?
You should probably have another sip of your coffee.
You were doing some work in a branch in your local of the project‚Ä¶</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Do you remember the name of the branch?</p>
<ul>
<li><p>I <a href="#pr-resume-no-branch">don‚Äôt remember, remind me</a></p></li>
<li><p>I <a href="#pr-resume-branch">remember, it‚Äôs the <code>add-example</code> branch</a></p></li>
</ul>
</div>
</div>
<div id="pr-resume-no-branch" class="section level3 step">
<h3>Choose a branch and resume working</h3>
<pre class="r"><code>pr_resume()</code></pre>
<pre><code>‚Ñπ No branch specified ... looking up local branches and associated PRs
Which branch do you want to checkout? (0 to exit)

1:             add-examples --&gt; #11 (&#39;@gadenbuie&#39;): Add Examples
2:      feature-exploration

Selection: 1
‚úì Switching to branch &#39;add-examples&#39;
‚úì Pulling from &#39;origin/add-examples&#39;
‚Ä¢ Use `pr_push()` to create or update PR.</code></pre>
<div class="decision">
<p>TK: next steps</p>
</div>
</div>
<div id="pr-resume-branch" class="section level3 step">
<h3>Get back to the branch</h3>
<pre class="r"><code>pr_resume(&quot;add-example&quot;)</code></pre>
<pre><code>‚úì Switching to branch &#39;add-examples&#39;
‚úì Pulling from &#39;origin/add-examples&#39;
‚Ä¢ Use `pr_push()` to create or update PR.</code></pre>
<div class="decision">
<p>TK: next steps</p>
</div>
</div>
<div id="pr-fetch" class="section level3 step">
<h3>Review someone else‚Äôs work</h3>
<pre class="r"><code>pr_fetch()</code></pre>
<pre><code>‚Ñπ No PR specified ... looking up open PRs
Which PR are you interested in? (0 to exit) 

1: &#39;gadenbuie/acme/#11&#39; (@gadenbuie): &#39;Add an example&#39;
2: &#39;gadenbuie/acme/#14&#39; (@wileycoyote): &#39;Model tuning features&#39;

Selection: </code></pre>
<p>Choosing selection 2 will perform the same steps as providing the PR number to <code>pr_fetch()</code>.</p>
<pre class="r"><code>pr_fetch(14)</code></pre>
<pre><code>‚úì Checking out PR &#39;gadenbuie/acme/#94&#39; (@wileycoyote): &#39;Model tuning features&#39;
‚úì Adding remote &#39;wileycoyote&#39; as &#39;git@github.com:wileycoyote/acme.git&#39;
‚úì Creating and switching to local branch &#39;wileycoyote-toone-model&#39;
‚úì Setting &#39;wileycoyote/toone-model&#39; as remote tracking branch</code></pre>
<div class="decision">
<p>TK: next steps</p>
</div>
</div>
</div>
<div id="do-update" class="section level2 step">
<h2>Update your local copy</h2>
<p>TK: <a href="#do-choose-branch">get to the right branch</a> and then choose <code>pr_pull()</code> or <code>pr_merge_main()</code></p>
<div id="pr-pull" class="section level3 step">
<h3>Update your local copy with a reviewer‚Äôs changes</h3>
<pre class="r"><code>pr_pull()</code></pre>
<pre><code>‚úì Pulling from &#39;origin/add-example&#39;</code></pre>
</div>
<div id="pr-pull-theirs" class="section level3 step">
<h3>Update your local copy with someone else‚Äôs changes</h3>
<pre class="r"><code>pr_pull()</code></pre>
<pre><code>‚úì Pulling from &#39;wileycoyote/toone-model&#39;</code></pre>
</div>
<div id="pr-merge-main" class="section level3 step">
<h3>Bring your work up to date with the main branch</h3>
<pre class="r"><code>pr_merge_main()</code></pre>
<pre><code>‚úì Pulling changes from &#39;origin/main&#39; (default branch of source repo)
Merged origin/main into add-example</code></pre>
</div>
<div id="do-choose-branch" class="section level3 step">
<h3>Get to the right place</h3>
<p>Let‚Äôs make sure we‚Äôre in the right branch in your local project.</p>
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span>
Which branch do you want to work with right now?</p>
<ul>
<li><p>The one I‚Äôm in right now<br/>
‚áí <em>you‚Äôre all set, go <a href="#do-work">get some work done</a></em>!</p></li>
<li><p>A local branch, but not the one I‚Äôm in now<br/>
‚áí <em>go <a href="#pr-resume">resume working in that branch</a>
and then come right back here.</em></p></li>
<li><p>A pull request branch I was looking at on GitHub<br/>
‚áí <em>go <a href="#pr-fetch">fetch the pull request</a>
and then come right back here</em>.</p></li>
</ul>
</div>
</div>
<div id="do-work" class="section level2 step">
<h2>Do some work</h2>
<p>You take a sip of your coffee (or the beverage of your choice),
turn up your favorite <a href="https://open.spotify.com/playlist/1fk6kpO8nb1KAUc1XAkAJ6">music to write code to</a> playlist on Spotify,
and line up 25 minutes in your <a href="https://pomofocus.io/">Pomodoro app</a>.</p>
<p>You‚Äôre ready to get something done!
Go write some code.
‚è≤Ô∏è
üßë‚Äçüíª
üéß</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span>
Sweet!
Now that feel good about your work,
you‚Äôre ready to <a href="#git-commit">take a snapshot of your updates</a>.</p>
</div>
<div id="git-commit" class="section level3 step">
<h3>Take a snapshot of your work</h3>
<p><em>If you like it then you shoulda made a <code>git commit</code>.</em></p>
<p>There are two parts to taking a snapshot of your code.
And really,
it‚Äôs less like taking a picture and more like sending yourself an email
with a copy of your files.</p>
<p>First, you‚Äôll pick the files that you want to add to the snapshot (or commit).
You can do this in the R console using <code>git_add()</code> from the <span class="pkg"><a href="https://docs.ropensci.org/gert/">gert</a></span> package.
Give the function a vector with the paths to the files you changed.</p>
<pre class="r"><code>gert::git_add(c(&quot;R/atom_arranger.R&quot;, &quot;man/atom_arranger.Rd&quot;))</code></pre>
<p>In git-speak,
<code>git_add()</code> adds the changes in the listed files to a staging area.
Running this command is like dragging a file into the email you‚Äôre writing.
We haven‚Äôt officially sent that email yet,
but we have a copy ready to go.
By the way,
you can still make more changes to the file
knowing that there‚Äôs a temporary copy in that email draft
in case anything goes wrong.</p>
<p>Then, once all the files you want to commit have been added,
you <em>commit</em> the changes.
In our email metaphor,
committing is a lot like pressing send on the email.</p>
<p>And just like an email,
the commit includes a message
where you can describe the updates you made to the files in the email (commit).</p>
<p>For this step you can use
<code>git_commit()</code>
(also from the <span class="pkg"><a href="https://docs.ropensci.org/gert/">gert</a></span> package)
which takes the commit message as a parameter.
Think of this message like the subject of an email to your future self.</p>
<pre class="r"><code>gert::git_commit(&quot;Add an example to ?atom_arranger()&quot;)</code></pre>
<p><em>P.S. You can do this adding-and-committing dance in the <a href="https://happygitwithr.com/rstudio-git-github.html">Git pane in RStudio</a>, too.</em></p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Are you ready to share your work?</p>
<ul>
<li><p>If <strong>yes</strong>, then you‚Äôre ready to <a href="#share-your-work">push your changes out into the world</a>.</p></li>
<li><p>If <strong>not</strong>, no worries. Just <a href="#do-work" class="clear-steps">keep on working</a>.</p></li>
</ul>
</div>
</div>
<div id="fix-something" class="section level3 step">
<h3>Fix something</h3>
<p>Oh no, you need to fix something!
I hope it‚Äôs just a typo and not a big scary error.
But first‚Ä¶</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span>
Quick question:
this thing that needs to be fixed ‚Äî what branch is it in?</p>
<ul>
<li><p>The one that I‚Äôm in now, I‚Äôm ready to <a class="clear-steps" href="#do-work">get some work done and fix this thing</a>.</p></li>
<li><p>Not this one, <a href="#do-choose-branch">I need to change branches</a>.</p></li>
</ul>
</div>
</div>
</div>
<div id="share-your-work" class="section level2 step">
<h2>Share your work</h2>
<p>Fantastic!
Your work is awesome and everyone is going to be happy to try it out.</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Let‚Äôs get your work off of your computer and out into the world.</p>
<ul>
<li><p>This <a href="#pr-push-new">new work you‚Äôre sharing</a> for the first time.</p></li>
<li><p>I‚Äôm <a href="#pr-push-yours">updating a pull request that I created</a>.</p></li>
<li><p>I‚Äôm <a href="#pr-push-theirs">updating a pull request from someone else</a>.</p></li>
</ul>
</div>
<div id="pr-push-new" class="section level3 step">
<h3>Create a new pull request</h3>
<p>To create a new pull request, you call <code>pr_push()</code>.</p>
<pre class="r"><code>pr_push()</code></pre>
<pre><code>‚úî Pushing local &#39;add-example&#39; branch to &#39;origin:add-example&#39;
‚úî Setting upstream tracking branch for &#39;add-example&#39; to &#39;origin/add-example&#39;
‚úî Create PR at link given below
‚úî Opening URL &#39;https://github.com/gadenbuie/acme/compare/add-example&#39;</code></pre>
<p><code>pr_push()</code> sends the local changes in your new branch to GitHub,
and opens a browser window where you can review your changes once more.
If everything looks good,
go ahead click the <em>Create Pull Request</em> button.</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Good job! How are you feeling now?</p>
<ul>
<li><p>I‚Äôm on a roll, let‚Äôs <a href="#pr-pause">start the next thing</a>.</p></li>
<li><p>Oh shoot, <a href="#fix-something">I saw something I need to fix</a>.</p></li>
<li><p>Great, that pull request was just merged and <a href="#pr-finish-yours">I‚Äôm done with this work</a>.</p></li>
<li><p>Someone else made changes in the PR <a href="#pr-pull">and now I need to update my local copy</a>.</p></li>
<li><p>Actually, the pull request was closed and <a href="#pr-forget-yours">I can forget about this work</a>.</p></li>
</ul>
</div>
</div>
<div id="pr-push-yours" class="section level3 step">
<h3>Update your existing pull request</h3>
<p>You just made <a href="#git-commit">and committed</a> some changes to an existing pull request,
and now you‚Äôd like to update the PR on GitHub.
<code>pr_push()</code> also does this for you!
Helpfully, before it pushes it checks to make sure your local branch is up-to-date.</p>
<pre class="r"><code>pr_push()</code></pre>
<pre><code>‚úî Checking that local branch &#39;add-example&#39; has the changes in &#39;origin/add-example&#39;
‚úî Pushing local &#39;add-example&#39; branch to &#39;origin:add-example&#39;
‚úî View PR at &#39;https://github.com/gadenbuie/acme/pull/11&#39; or call `pr_view()`</code></pre>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Phenomenal! What do you want to do next?</p>
<ul>
<li><p>Rock on! I‚Äôm moving on to <a href="#pr-pause">start the next thing</a>.</p></li>
<li><p>Wait a second, <a href="#fix-something">I saw something I need to fix</a>.</p></li>
<li><p>Someone else made changes in the PR <a href="#pr-pull">and now I need to update my local copy</a>.</p></li>
<li><p>I just merged this PR and <a href="#pr-finish-yours">I‚Äôm all done with this work</a>.</p></li>
<li><p>Never mind, my <a href="#pr-forget-yours">PR was closed and I‚Äôd like to forget about this work</a>.</p></li>
</ul>
</div>
</div>
<div id="pr-push-theirs" class="section level3 step">
<h3>Update someone else‚Äôs pull request</h3>
<p>You just made a change in a branch for a PR
with work that someone else is suggesting for your package.
<code>pr_push()</code> is very smart and knows how to send the changes to the correct repository.
Here‚Äôs the output you‚Äôll see after you make a few changes
to the pull request submitted by <code>@wileycoyote</code> in the <code>toone-model</code> branch.</p>
<pre class="r"><code>pr_push()</code></pre>
<pre><code>‚úî Checking that local branch &#39;wileycoyote-toone-model&#39; has the changes in &#39;wileycoyote/toone-model&#39;
‚úî Pushing local &#39;wileycoyote-toone-model&#39; branch to &#39;wilecoyote:toone-model&#39;
‚úî View PR at &#39;https://github.com/gadenbuie/acme/pull/14&#39; or call `pr_view()`</code></pre>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> Phenomenal! What do you want to do next?</p>
<ul>
<li><p>Beep, beep! I‚Äôm moving on to <a href="#pr-pause">start the next thing</a>.</p></li>
<li><p>Hang on, <a href="#fix-something">I saw something I need to fix</a>.</p></li>
<li><p>That‚Äôs all I wanted to do, I can <a href="#pr-forget-theirs">forget about this PR now</a>.</p></li>
<li><p>Someone else made changes in the PR <a href="#pr-pull-theirs">and now I need to update my local copy</a>.</p></li>
<li><p>I just merged this pull request and <a href="#pr-finish-theirs">I‚Äôm all done with this work</a>.</p></li>
</ul>
</div>
</div>
</div>
<div id="wrap-up" class="section level2 step">
<h2>Wrap Up</h2>
<div id="pr-pause" class="section level3 step">
<h3>Pause your work</h3>
<p>If you landed here,
you‚Äôre not completely done with the thing you were working on,
but you do want to put it aside for now.
That‚Äôs alright, that work will be waiting patiently for you in a local branch.</p>
<p>Call <code>pr_pause()</code> to switch from the current branch back to the default branch,
and to make sure you‚Äôve got the latest changes in the default branch.</p>
<pre class="r"><code>pr_pause()</code></pre>
<pre><code>‚úì Switching back to default branch (&#39;main&#39;)
‚úì Pulling changes from &#39;origin/main&#39;</code></pre>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> <a href="#start" class="clear-steps">Go back to Start</a> to decide to decide what‚Äôs next in your adventure.</p>
</div>
</div>
<div id="pr-finish-yours" class="section level3 step">
<h3>Finish your work</h3>
<p>Congrats! Your pull request was merged!
That‚Äôs awesome.
Now it‚Äôs time to wrap things up by calling <code>pr_finish()</code>.</p>
<pre class="r"><code>pr_finish()</code></pre>
<pre><code>‚úì Checking that remote branch &#39;origin/add-example&#39; has the changes in &#39;add-example&#39;
‚úì Switching back to default branch (&#39;main&#39;)
‚Ñπ Pulling changes from &#39;origin/main&#39;
‚úì Deleting local &#39;add-example&#39; branch</code></pre>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> <a href="#start" class="clear-steps">Go back to Start</a> to decide what‚Äôs next in your adventure.</p>
</div>
</div>
<div id="pr-finish-theirs" class="section level3 step">
<h3>Finish your work</h3>
<p>Well done, your review of someone else‚Äôs work is complete and their PR is merged!
That‚Äôs awesome.
Now it‚Äôs time to wrap things up by calling <code>pr_finish()</code>.</p>
<pre class="r"><code>pr_finish()</code></pre>
<pre><code>‚úî Checking that remote branch &#39;wileycoyote/toone-model&#39; has the changes in &#39;local/wileycoyote-toone-model&#39;
‚úî Switching back to &#39;main&#39; branch
‚úî Pulling changes from GitHub source repo &#39;origin/main&#39;
‚úî Deleting local &#39;wileycoyote-toone-model&#39; branch
‚úî Removing remote &#39;wileycoyote&#39;</code></pre>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> <a href="#start" class="clear-steps">Go back to Start</a> to decide what‚Äôs next in your adventure.</p>
</div>
</div>
<div id="pr-forget-yours" class="section level3 step">
<h3>Forget about your work</h3>
<p>Well that was fun.
But now you‚Äôre done with this branch
and you call <code>pr_forget()</code> to delete it from your local copy.</p>
<pre class="r"><code>pr_forget()</code></pre>
<pre><code>Local branch &#39;feature-exploration&#39; has no associated remote branch.
If we delete &#39;feature-exploration&#39;, any work that exists only on this branch work may be hard for you to recover.
Proceed anyway?

1: No way
2: Not now
3: Yes

Selection: 3
‚úì Switching back to default branch (&#39;main&#39;)
‚úì Pulling changes from &#39;origin/main&#39;
‚úì Deleting local &#39;feature-exploration&#39; branch</code></pre>
<p>Notice that <code>pr_forget()</code> warns you about any work you might lose
and gives you a chance to rethink it.</p>
<div class="decision">
<p><i class="way-point fas fa-map-signs" aria-hidden="true" title="Decision Time"></i><span class="sr-only">Decision time:</span> <a href="#start" class="clear-steps">Go back to Start</a> to decide what‚Äôs next in your adventure.</p>
</div>
</div>
<div id="pr-forget-theirs" class="section level3 step">
<h3>Forget about their work</h3>
<p>TK: <code>pr_forget()</code> for theirs</p>
</div>
</div>
<div id="download" class="section level2 step">
<h2>Download the image</h2>
<ul>
<li><a href="usethis-pr-flow.jpg">Small JPG Image (186 KB)</a></li>
<li><a href="usethis-pr-flow-medium.jpg">Medium JPG Image (500 KB)</a></li>
<li><a href="usethis-pr-flow-large.jpg">Large JPG Image (886 KB)</a></li>
<li><a href="usethis-pr-flow.svg">SVG (40 KB)</a></li>
<li><a href="usethis-pr-flow.drawio">Source File <code>.drawio</code> (3.8 KB)</a></li>
</ul>
<div class="cc-box">
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0;margin-right:1em;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" align="left" />
</a>
<em xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/StillImage" property="dct:title" rel="dct:type">
  Pull Request Flow with usethis
</em>
by 
<a xmlns:cc="http://creativecommons.org/ns#" href="https://www.garrickadenbuie.com/blog/pull-request-flow-usethis" property="cc:attributionName" rel="cc:attributionURL">
Garrick Aden-Buie
</a> is licensed under a 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</div>
</div>
<div id="section" class="section level2">
<h2></h2>
<div id="step-list" style="display:none">

</div>
<style type="text/css">
html {
  scroll-behavior: smooth;
  scroll-padding-top: 2rem;
}
.cc-box {
  padding: 1em 1em;
  border: 2px solid #514961;
  border-radius: 3px;
}
@media (prefers-color-scheme: dark) {
  .cc-box {
    color: #dbd7e3;
  }
}
.cc-box :first-child {
  margin-top: 0;
}
.cc-box :last-child {
  margin-bottom: 0;
}
.fas.fa-map-signs,
.fas.fa-arrow-alt-circle-left {
    color: var(--accent-dark);
}

.decision.decided a {
  color: var(--text-dark);
}

.decision.decided a.picked {
  color: var(--purple);
}

.decision.decided .way-point.fas.fa-map-signs {
    color: var(--purple);
}

@media screen and (min-width: 48em) {
  .way-point {
    position: absolute;
    left: -1.5em;
    line-height: 1.25;
    font-size: 1.25em;
    z-index: 1000;
  }
  
  .page, .post {
    position: relative;
  }
  
  main > article > footer {
    height: 100vh;
  }
}

.sr-only {
  border: 0 !important;
  clip: rect(1px, 1px, 1px, 1px) !important;
  -webkit-clip-path: inset(50%) !important;
  clip-path: inset(50%) !important;
  height: 1px !important;
  overflow: hidden !important;
  padding: 0 !important;
  position: absolute !important;
  width: 1px !important;
  white-space: nowrap !important;
}

#instructions-non-interactive {
  display: none;
}

.non-interactive #skip-to-non-interactive,
.non-interactive #instructions-interactive {
  display: none;
}

.non-interactive #instructions-non-interactive {
  display: unset;
}

.fade-in {
    -webkit-animation: fade-in 1s cubic-bezier(0.250, 0.460, 0.450, 0.940) 250ms both;
            animation: fade-in 1s cubic-bezier(0.250, 0.460, 0.450, 0.940) 250ms both;
}

.fade-out-bck {
    -webkit-animation: fade-out-bck 0.66s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
            animation: fade-out-bck 0.66s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
}

/* ----------------------------------------------
 * Generated by Animista on 2021-9-26 22:30:33
 * Licensed under FreeBSD License.
 * See http://animista.net/license for more info. 
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

/**
 * ----------------------------------------
 * animation fade-in
 * ----------------------------------------
 */
@-webkit-keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
/**
 * ----------------------------------------
 * animation fade-out-bck
 * ----------------------------------------
 */
@-webkit-keyframes fade-out-bck {
  0% {
    -webkit-transform: translateZ(0);
            transform: translateZ(0);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateZ(-80px);
            transform: translateZ(-80px);
    opacity: 0;
  }
}
@keyframes fade-out-bck {
  0% {
    -webkit-transform: translateZ(0);
            transform: translateZ(0);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateZ(-80px);
            transform: translateZ(-80px);
    opacity: 0;
  }
}

</style>
<script type="text/javascript">
(function() {
  // check for interactive query param
  const urlParams = new URLSearchParams(window.location.search)
  const isInteractive = (urlParams.get('interactive') || 1) == 1 ? true : false
  const introOptions = document.getElementById('intro-options')
  
  if (!isInteractive) {
    document.querySelector('main > article > .post-content').classList.add('non-interactive')
    introOptions.innerHTML += `<li><p>Yes, but I'd like you to <a href="index.html?interactive=1#intro">walk me through my adventure</a>.</p></li>`
    return;
  }
  
  introOptions.innerHTML = `<li><p>Yes, <a href="#start">walk me through my adventure</a>.</p></li>
    <li><p>Yes, but I'd prefer to <a href="index.html?interactive=0#intro">read and navigate on my own</a>.</p></li>`

  const story = document.getElementById("story")
  const staging = document.getElementById("step-list")
  const steps = {}
  const currentStory = []
  
  Array.from(document.querySelectorAll(".step.level3"))
    .forEach(function(step) {
      staging.appendChild(step)
      steps[step.id] = step
    })
  Array.from(document.querySelectorAll(".step.level2"))
    .forEach(function(step) {
      staging.appendChild(step)
      steps[step.id] = step
    })
    
  function updateURL() {
    const state = {
      interactive: isInteractive ? 1 : 0,
      steps: currentStory.map(el => el.id)
    }
    const params = new URLSearchParams({
      interactive: state.interactive,
      steps: state.steps.join(',')
    })
    window.history.pushState(state, '', `${location.pathname}?${params}`)
  }
  
  function getCurrentStoryStepIds() {
    return currentStory.map(el => el.id)
  }
  
  function getAllStepIds() {
    return Object.keys(steps)
  }
  
  function isValidStep(stepId) {
    return getAllStepIds().includes(stepId) && 
      steps[stepId] ? true : false
  }
  
  function isStepInStory(stepId) {
    return getCurrentStoryStepIds().includes(stepId)
  }
  
  function addStep(stepId) {
    const newStep = steps[stepId].cloneNode(true)
    newStep.classList.add('fade-in')
    currentStory.push(newStep)
    story.appendChild(newStep)
    return newStep
  }
  
  function walkForward(stepId, update_url) {
    if (typeof update_url === 'undefined') {
      update_url = true
    }
    
    if (currentStory.length) {
      markDecision(currentStory[currentStory.length - 1], stepId)
    } else {
      // assume we're at the intro
      markDecision(document.getElementById('intro'), stepId)
    }
    
    const newStep = addStep(stepId)
    newStep.scrollIntoView({behavior: 'smooth'})
    setTimeout(() => newStep.classList.remove('fade-in'), 1100)
    update_url ? updateURL() : null
    return newStep
  }
  
  function walkBackward(stepId, update_url) {
    if (typeof update_url === 'undefined') {
      update_url = true
    }
    
    // clears steps between target and current step
    const idxNext = getCurrentStoryStepIds().indexOf(stepId)
    currentStory[idxNext].scrollIntoView({block: 'start', inline: 'nearest', behavior: 'smooth'})
    while (currentStory.length - 1 > idxNext) {
      let lastStep = currentStory.pop()
      lastStep.classList.add('fade-out-bck')
      setTimeout(() => lastStep.remove(), 1100)
    }
    update_url ? updateURL() : null
    const newLastStep = currentStory[currentStory.length - 1]
    unmarkDecision(newLastStep)
    return newLastStep
  }
  
  function resetStory() {
    while (story.children) {
      story.removeChild(story.firstChild)
    }
    while (currentStory.length) {
      currentStory.pop()
    }
    updateURL()
    document.getElementById('intro').scrollIntoView({behavior: 'smooth'})
  }
  
  function markDecision(step, stepId) {
    const link = step.querySelector(`.decision a[href="#${stepId}"]`)
    const decisionList = step.querySelector('.decision')
    link.classList.add('picked')
    decisionList.classList.add('decided')
    let choices = decisionList.querySelectorAll('a:not(.picked)')
    choices = Array.from(choices)
    choices.forEach(function(link) {
      const span = document.createElement('span')
      span.classList = 'path-untaken'
      span.dataset.href = link.getAttribute('href')
      span.dataset.classes = Array.from(link.classList).join(' ')
      span.innerHTML = link.innerHTML
      link.insertAdjacentElement('afterend', span)
      link.parentElement.removeChild(link)
    })
  }
  
  function unmarkDecision(step) {
    const decisionList = step.querySelector('.decision.decided')
    decisionList.classList.remove('decided')
    let choices = decisionList.querySelectorAll(['a.picked', 'span.path-untaken'])
    choices = Array.from(choices)
    choices.forEach(function(el) {
      if (el.matches('a.picked')) {
        el.classList.remove('picked')
        return;
      }
      const link = document.createElement('a')
      link.classList = el.dataset.classes
      link.href = el.dataset.href
      link.innerHTML = el.innerHTML
      el.insertAdjacentElement('afterend', link)
      el.parentElement.removeChild(el)
    })
  }
  
  // Restore steps from URL
  let initSteps = new URLSearchParams(window.location.search).get('steps')
  if (initSteps) {
    initSteps = initSteps.split(',').map(walkForward)
    setTimeout(
      () => initSteps[initSteps.length - 1].scrollIntoView({behavior: 'smooth'}),
      1000
    )
  }
  
  // Handle back button
  window.addEventListener('popstate', function(ev) {
    if (ev.state && ev.state.steps) {
      if (ev.state.steps.length === 0) {
        resetStory()
      } else if (ev.state.steps.length < currentStory.length) {
        // Go back to the previous last step
        walkBackward(ev.state.steps.pop(), false)
      } else if (ev.state.steps.length > currentStory.length) {
        // Go forward to the previous last step
        walkForward(ev.state.steps.pop(), false)
      }
    }
  })

  document
    .querySelector('main > article > .post-content')
    .addEventListener('click', function(ev) {
      if (ev.target.tagName != 'A') {
        return;
      }
      
      const stepId = ev.target.getAttribute('href').replace(/^#/, '')

      if (!isValidStep(stepId)) {
        console.warn(`Unknown step id #${stepId}, treating like a normal link`)
        return;
      }
      
      if (!isStepInStory(stepId)) {
        ev.preventDefault()
        walkForward(stepId)
      } else if (ev.target.matches('.clear-steps')) {
        ev.preventDefault()
        walkBackward(stepId)
      }
    })
  
  // remove the toc sidebar since it doesn't make sense here
  function removeTOC() {
    const toc = document.querySelector(".table-of-contents")
    if (toc) {
      toc.remove()
    } else {
      setTimeout(removeTOC, 10)
    }
  }
  document.addEventListener('DOMContentLoaded', removeTOC)
})()
</script>
</div>
